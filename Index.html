<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kas Gang E21-25 (Petugas)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ======================================= */
        /* === CSS UMUM & FULL LAYAR (MODERN) === */
        /* ======================================= */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa; /* Latar belakang lebih cerah */
            color: #333;
            text-align: center;
        }

        /* === MODIFIKASI BARU === */
        /* SPLASH SCREEN STYLING */
        #loading-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #17a2b8, #007bff);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
        .spinner {
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1.5s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #loading-page h1 {
            color: white;
            margin-top: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
        }
        /* END SPLASH SCREEN STYLING */
        
        .container {
            width: 100%;
            min-height: 100vh;
            margin: 0 auto;
            background: #ffffff;
            padding: 0;
            box-shadow: none; 
            position: relative;
            padding-bottom: 70px; /* Ruang untuk bottom bar */
        }

        .content-wrapper {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 0; /* Biarkan full width untuk mobile-first */
            box-shadow: none;
            text-align: left;
        }
        
        @media (min-width: 600px) {
            .content-wrapper {
                border-radius: 12px;
                padding: 30px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
        }

        h1 {
            font-size: 1.8em;
            color: #17a2b8; /* Warna header baru */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            text-transform: uppercase;
            font-weight: 700;
        }
        
        /* ======================================= */
        /* === LOGIN STYLING (ALA GOOGLE) === */
        /* ======================================= */
        #login-container {
            display: none; /* === MODIFIKASI BARU: Sembunyikan saat start === */
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f7fa; 
            position: fixed; 
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }
        .login-box, .signup-box {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 380px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }
        .login-box h2, .signup-box h3 {
            color: #17a2b8;
            margin-bottom: 10px;
            font-size: 1.8em;
            font-weight: 600;
        }
        .login-logo-text {
            color: #ff5722;
            font-size: 1.1em;
            margin-bottom: 30px;
            display: block;
        }
        .login-box input[type="text"],
        .login-box input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 20px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .login-box input:focus {
            border-color: #17a2b8;
            box-shadow: 0 0 0 0.2rem rgba(23, 162, 184, 0.25);
            outline: none;
        }
        .login-box button.btn-primary {
            width: 100%;
            padding: 14px;
            background-color: #17a2b8; /* Biru Tosca/Cyan */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px 10px rgba(23, 162, 184, 0.3);
        }
        .login-box button.btn-primary:hover {
            background-color: #138496;
            transform: translateY(-1px);
        }
        .separator {
            border: 0;
            border-top: 1px solid #eee;
            margin: 20px 0;
        }
        .signup-text a, .btn-secondary {
            color: #ff5722;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.3s;
        }
        .signup-text a:hover {
            color: #e64a19;
        }
        .btn-secondary {
            background: none;
            border: 1px solid #ff5722;
            padding: 10px 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        #login-message {
            color: #dc3545;
            margin-top: 15px;
            font-weight: bold;
        }
        .contact-info {
            text-align: left;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        /* ======================================= */
        /* === DASHBOARD PETUGAS (DOMPEt DIGITAL STYLE) === */
        /* ======================================= */
        #admin-dashboard {
            display: none;
            text-align: left;
            padding-top: 10px;
        }
        
        /* HEADER/MENU BAR BARU */
        #home-menu {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #17a2b8;
            color: white;
            padding: 15px 20px;
            border-radius: 0; /* Full width */
            margin: -20px -20px 20px -20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        @media (min-width: 600px) {
             #home-menu {
                border-radius: 12px 12px 0 0;
                margin: -30px -30px 20px -30px;
             }
        }
        #home-menu h2 {
            margin: 0;
            font-size: 1.1em;
            font-weight: 500;
        }
        #home-menu button {
            background-color: #ff5722;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }
        #home-menu button:hover {
            background-color: #e64a19;
        }

        /* SALDO BOX (MODERN CARD) */
        .saldo-box {
            background: linear-gradient(135deg, #17a2b8, #007bff); /* Gradient biru yang segar */
            color: white;
            padding: 25px 30px; 
            border-radius: 15px; 
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0, 123, 255, 0.3);
            position: relative;
            overflow: hidden;
            text-align: left;
        }
        .saldo-box h3 {
            margin-top: 0;
            font-size: 1.1em;
            margin-bottom: 5px;
            font-weight: 400;
            opacity: 0.8;
            display: flex;
            align-items: center;
        }
        .saldo-box h3 i {
            margin-right: 8px;
        }
        #current-saldo-value {
            font-size: 2.5em; 
            font-weight: 700;
            display: block;
            margin-top: 5px;
        }
        .saldo-running-text {
            font-size: 0.9em;
            margin-top: 15px;
            opacity: 0.9;
        }
        .saldo-running-text span {
             animation: none; /* Matikan marquee untuk tampilan lebih stabil */
             display: block;
             white-space: normal;
        }

        /* === MODIFIKASI BARU: MOTIVASI RUNNING TEXT === */
        .motivasi-box {
            background-color: #fff3cd; 
            border: 1px solid #ffc107;
            color: #856404;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
            white-space: nowrap;
            text-align: center; /* Teks Motivasi dibuat rata tengah */
        }
        .motivasi-box p {
            margin: 0;
            font-size: 0.9em;
            /* display: inline-block; */ /* Dihapus untuk membuat teks motivasi biasa */
            /* padding-right: 50px; */ 
            font-style: italic;
            white-space: normal; /* Biar wrap */
        }
        .marquee-content {
             /* display: inline-block; */
             /* padding-left: 100%; */
             /* animation: marquee 30s linear infinite; */
             white-space: normal;
        }
        /* @keyframes marquee {
            0%   { transform: translate(0, 0); }
            100% { transform: translate(-100%, 0); }
        } */
        /* END MOTIVASI RUNNING TEXT */
        
        /* MENU GRID (ICON & CARD MODERN) - **REVISI PENTING** */
        .menu-toggle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            margin-bottom: 15px;
            cursor: pointer;
        }
        .menu-toggle-header h3 {
            color:#ff5722; 
            font-size: 1.3em;
            margin: 0;
        }
        .menu-toggle-header button {
            background: none;
            border: none;
            color: #17a2b8;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .menu-toggle-header button i.rotated {
            transform: rotate(180deg);
        }

        .menu-grid {
            /* REVISI: Mengatur grid untuk 3 kolom di mobile */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); 
            gap: 10px; /* Jarak diperkecil */
            transition: max-height 0.3s ease-in-out, opacity 0.3s;
            overflow: hidden;
            max-height: 500px; 
            margin-bottom: 30px; /* Tambahan margin */
        }
        
        @media (min-width: 400px) {
            .menu-grid {
                 grid-template-columns: repeat(4, 1fr); /* 4 kolom di layar agak besar */
            }
        }
        
        .menu-grid.hidden {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
            margin-bottom: 0;
        }
        
        .menu-item {
            background-color: white;
            color: #333;
            padding: 15px 5px; /* Padding diperkecil */
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid #e0e0e0;
        }
        .menu-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        .menu-item:active {
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .menu-item i {
            font-size: 1.8em; /* Ukuran ikon diperkecil */
            margin-bottom: 5px;
            display: block;
            color: #ff5722; /* Warna ikon aksen */
        }
        .menu-item p {
            margin: 0;
            font-weight: 500;
            font-size: 0.8em; /* Ukuran teks diperkecil */
            line-height: 1.1;
        }
        .menu-item.data-kas-saya i {
            color: #17a2b8;
        }
        .menu-item.data-kas-saya p:last-of-type {
            font-size: 0.6em; /* Ukuran blok diperkecil */
            margin-top: 2px;
            font-weight: 400;
            color: #6c757d;
        }
        
        /* ======================================= */
        /* === RESULT & PAYMENT STYLING (DIJAGA) === */
        /* ======================================= */
        .data-header {
            display: grid;
            grid-template-columns: 40% 30% 30%;
            background-color: #17a2b8;
            color: white;
            font-weight: bold;
            border-bottom: 2px solid #138496;
            padding: 10px;
            border-radius: 5px 5px 0 0;
            margin-top: 20px;
        }
        .data-row {
            display: grid;
            grid-template-columns: 40% 30% 30%;
            padding: 10px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        .data-row:nth-child(even) {
            background-color: #f9f9f9;
        }
        .data-row span {
            text-align: left;
        }
        .data-row span:nth-child(2), .data-row span:nth-child(3) {
            text-align: center;
        }
        .lunas {
            color: #28a745;
            font-weight: bold;
        }
        .belum {
            color: #ff5722;
            font-weight: bold;
        }
        
        /* TOMBOL PEMBAYARAN DI DETAIL (LEBIH PROPORSI) */
        #btn-show-manual-from-detail {
            background-color: #ff5722; /* Aksen Oranye */
            box-shadow: 0 4px 15px rgba(255, 87, 34, 0.4);
            font-size: 1.1em; /* Sedikit dikecilkan */
            padding: 12px 20px; /* Dikecilkan */
            width: 100%;
            border-radius: 10px;
        }
        #btn-show-manual-from-detail:hover {
            background-color: #e64a19;
            box-shadow: 0 6px 20px rgba(255, 87, 34, 0.6);
        }
        
        /* TOMBOL KEMBALI */
        .btn-back {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        .btn-back:hover {
            background-color: #5a6268;
        }

        /* LAPORAN KAS */
        .cash-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .cash-table th, .cash-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        .cash-table th {
            background-color: #ff5722;
            color: white;
            font-weight: bold;
        }
        .cash-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .report-summary-box {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }
        .summary-card {
            flex: 1;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
        }
        .summary-card h4 {
            margin-top: 0;
            font-size: 1em;
            font-weight: 500;
        }
        .summary-card p {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 0;
        }
        .card-pemasukan {
            background-color: #e6ffed;
            color: #1e7e34;
            border-left: 5px solid #28a745;
        }
        .card-pengeluaran {
            background-color: #f7e8e8;
            color: #721c24;
            border-left: 5px solid #dc3545;
        }

        /* TOTAL TUNGGAKAN DETAIL */
        .tunggakan-header {
            display: grid;
            grid-template-columns: 50% 25% 25%;
            background-color: #17a2b8;
            color: white;
            font-weight: bold;
            padding: 10px;
            border-radius: 5px 5px 0 0;
            margin-top: 10px;
        }
        .tunggakan-line {
            display: grid;
            grid-template-columns: 50% 25% 25%;
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        .tunggakan-total {
            display: grid;
            grid-template-columns: 75% 25%;
            padding: 12px 10px;
            border-top: 3px double #17a2b8;
            color: #ff5722; 
            font-weight: bold;
            font-size: 1.1em;
            background-color: #fcfcfc;
        }
        .tunggakan-line .col-deskripsi {
            font-weight: 600;
        }
        
        /* Modifikasi untuk memastikan tampilan tetap rapi di mobile */
        @media (max-width: 450px) {
            .data-header, .data-row {
                grid-template-columns: 40% 30% 30%; 
                font-size: 0.9em;
            }
            .tunggakan-header, .tunggakan-line {
                font-size: 0.9em;
            }
            .tunggakan-line .col-deskripsi {
                flex-basis: 45%;
                font-weight: normal;
            }
            .tunggakan-total {
                grid-template-columns: 65% 35%;
                font-size: 1em;
            }
        }
        
        /* ======================================= */
        /* === MODIFIKASI FORM PEMBAYARAN (XL) === */
        /* ======================================= */
        #manual-payment-section h3 {
            color: #17a2b8;
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        #manual-payment-section .form-group {
            margin-bottom: 20px;
        }
        #manual-payment-section label {
            font-weight: 600;
            display: block;
            margin-bottom: 8px;
            color: #333;
        }
        #manual-payment-section input[type="number"],
        #manual-payment-section input[type="text"] {
            width: 100%;
            padding: 15px; /* Lebih besar */
            margin-bottom: 5px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1.1em; /* Lebih besar */
        }
        
        /* Styling untuk Input Jumlah Pembayaran agar lebih menonjol (XL) */
        #manual-amount {
            font-size: 1.5em !important;
            font-weight: bold;
            color: #ff5722;
            border: 2px solid #ff5722 !important;
            box-shadow: 0 0 10px rgba(255, 87, 34, 0.2);
            text-align: right;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .radio-group input[type="radio"] {
            display: none;
        }
        .radio-group label {
            flex: 1;
            min-width: 100px;
            padding: 15px;
            border: 2px solid #ced4da;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: normal;
            margin-bottom: 0;
        }
        .radio-group input[type="radio"]:checked + label {
            border-color: #17a2b8;
            background-color: #e8f5f7;
            color: #17a2b8;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(23, 162, 184, 0.15);
        }
        
        #payment-form-manual button[type="submit"] {
            width: 100%;
            padding: 18px; /* Lebih besar (XL) */
            background-color: #17a2b8; 
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2em; /* Lebih besar (XL) */
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.4);
            margin-top: 10px;
        }
        #payment-form-manual button[type="submit"]:hover {
            background-color: #138496; 
            transform: translateY(-1px);
        }
        
        /* TUNGGAKAN 2025 GROUP */
        #group-tunggakan-2025 {
            background-color: #fff3cd !important;
            border: 1px solid #ffc107 !important;
            color: #856404;
            padding: 15px !important;
        }
        #group-tunggakan-2025 label {
            color: #856404 !important;
        }
        #tunggakan-2025-amount {
            background-color: #fffae0 !important;
            color: #856404 !important;
            font-weight: bold;
            font-size: 1.1em !important;
            text-align: right;
        }
        
        /* ======================================= */
        /* === MODIFIKASI INTRUKSI (XL) === */
        /* ======================================= */
        #instruction-container {
            display: none;
            text-align: left;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            background-color: #fff;
        }
        #instruction-container h3 {
             color: #17a2b8;
             font-size: 1.8em;
             margin-bottom: 20px;
             text-align: center;
        }
        #instruction-container p, #instruction-container ul {
             font-size: 1.1em;
        }
        .qris-display {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            border: 1px dashed #ccc;
            border-radius: 10px;
        }
        .qrcode-image {
            max-width: 250px;
            width: 100%;
            height: auto;
            border: 5px solid white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }
        .warning-text {
             display: block;
             text-align: center;
             color: #dc3545;
             font-style: italic;
             margin-top: 20px;
             font-size: 0.9em;
             font-weight: 500;
        }
        
        /* Tombol Konfirmasi WhatsApp (XL) */
        #btn-whatsapp-proof {
            width: 100%;
            padding: 18px; /* Lebih besar (XL) */
            background-color: #dc3545; /* Awal merah, untuk non-aktif */
            color: white;
            border: none;
            border-radius: 10px;
            cursor: not-allowed;
            font-weight: bold;
            font-size: 1.2em; /* Lebih besar (XL) */
            transition: background-color 0.3s, transform 0.1s;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.2);
        }
        #btn-whatsapp-proof.active {
            background-color: #28a745; /* Aktif hijau */
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }
        #btn-whatsapp-proof.active:hover {
            background-color: #1e7e34;
            transform: translateY(-1px);
        }
        
        #confirmation-container {
            display: flex;
            align-items: center;
            margin-top: 20px;
            background-color: #f7e8e8;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dc3545;
        }
        #confirmation-container input[type="checkbox"] {
            transform: scale(1.5);
            margin-right: 15px;
            min-width: 20px;
            min-height: 20px;
        }
        #confirmation-container label {
            font-size: 1em;
            cursor: pointer;
        }
        
        .copy-button-small {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            margin-left: 10px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background-color 0.3s;
        }
        .copy-button-small:hover {
            background-color: #138496;
        }
        
        /* DATA ANGGOTA TABLE */
        .data-anggota-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.95em;
        }
        .data-anggota-table th, .data-anggota-table td {
            padding: 10px;
            border: 1px solid #e0e0e0;
            text-align: left;
        }
        .data-anggota-table th {
            background-color: #17a2b8;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
        }
        .data-anggota-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .edit-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background-color 0.2s;
            margin-left: 5px;
        }
        .edit-button:hover {
            background-color: #0056b3;
        }

        /* === MODIFIKASI BARU: WARNA MERAH TUNGGAKAN 2025 === */
        .tunggakan-2025-value {
            color: #dc3545; /* Merah */
            font-weight: bold;
        }
        /* END MODIFIKASI BARU */
        
        /* ======================================= */
        /* === BOTTOM NAVIGATION BAR (BARU) === */
        /* ======================================= */
        #bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 5px 0;
            color: #6c757d;
            cursor: pointer;
            transition: color 0.2s, background-color 0.2s;
            position: relative;
            font-size: 0.8em;
            font-weight: 500;
        }
        .nav-item:hover {
            color: #17a2b8;
        }
        .nav-item.active {
            color: #17a2b8;
            font-weight: bold;
        }
        .nav-item i {
            font-size: 1.4em;
            display: block;
            margin-bottom: 2px;
        }
        
        .nav-item.profile-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
            line-height: 1.2;
        }
        .profile-item p {
            margin: 0;
            font-weight: 600;
        }
        .profile-item span {
            font-size: 0.7em;
            color: #ff5722;
        }
        
        /* === STYLE BARU UNTUK NOTIFIKASI POPUP (MODIFIKASI) === */
        #notification-popup {
            display: none;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #e6ffed;
            color: #1e7e34;
            padding: 15px 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            border: 1px solid #28a745;
            z-index: 2000;
            font-size: 1.1em;
            font-weight: bold;
            text-align: center;
            max-width: 90%;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; top: 0; }
            to { opacity: 1; top: 20px; }
        }
        /* END STYLE BARU NOTIFIKASI */


    </style>
</head>
<body>

<div id="loading-page">
    <div class="spinner"></div>
    <h1>Kas gang E21-25</h1>
    <p>Loading Data 
    warga...</p>
</div>

<div id="notification-popup" onclick="this.style.display='none'">
    <i class="fas fa-bell"></i> <span id="notification-message"></span>
</div>

<div id="login-container">
    <div class="login-box" id="login-box">
        <h2 id="login-title"><i class="fas fa-wallet"></i> Kas Gang</h2>
        <span class="login-logo-text">WARGA GANG E21-25</span>
        <form id="login-form">
            <input type="text" id="username" placeholder="Username" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit" class="btn-primary"><i class="fas fa-sign-in-alt"></i> Masuk</button>
            <hr class="separator">
            <p class="signup-text">Belum punya akun? <a href="#" id="show-signup">Daftar Akun</a></p>
        </form>
        <p id="login-message" class="error-message" style="display:none;">Username atau Password salah!</p>
    </div>

    <div class="signup-box" id="signup-box" style="display:none;">
        <h3><i class="fas fa-user-plus"></i> Pendaftaran Akun</h3>
        <div class="contact-info">
            <p>Untuk **pendaftaran akun baru** sebagai warga Iuran, harap:</p>
            <ol>
                <li>Hubungi Admin (Bendahara Kas Gang E21-25) secara langsung.</li>
                <li>Sertakan nama lengkap dan Blok Rumah Anda.</li>
            </ol>
            <p style="font-weight: bold; margin-top: 15px;">Admin: Bpk. .... (E21-25)</p>
            <p style="font-size: 0.9em; color: #dc3545; font-style: italic;">(Proses pendaftaran hanya bisa dilakukan oleh admin.)</p>
        </div>
        <button class="btn-secondary" id="hide-signup"><i class="fas fa-chevron-left"></i> Kembali ke Login</button>
    </div>
</div>

<div class="container" id="container-iuran" style="display:none;">
    <div class="content-wrapper">
        <div id="home-menu">
            <h2 id="current-user-info"><i class="fas fa-user-shield"></i> Selamat Datang, [Nama]</h2>
            <button onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>

        <div id="admin-dashboard">
            <div class="saldo-box">
                <h3><i class="fas fa-coins"></i> Saldo Kas Terkini</h3>
                <span id="current-saldo-value">Rp 0</span>
                <div class="saldo-running-text">
                    <span id="current-saldo-text">GANG E21-25. DARI KITA UNTUK KITA.</span> </div>
            </div>
            
            <div class="menu-toggle-header" onclick="toggleMenuGrid()">
                <h3><i class="fas fa-th-large"></i> Menu Layanan Cepat</h3>
                <button id="toggle-menu-btn"><i class="fas fa-chevron-up"></i></button>
            </div>
            <div class="menu-grid" id="menu-grid-dashboard">
                <div class="menu-item data-kas-saya" onclick="showDataUser(currentUserId)">
                    <i class="fas fa-id-card-alt"></i>
                    <p>Data Kas Saya</p>
                    <p style="font-size:0.8em; margin-top: 5px;">(Blok: E21-51)</p>
                </div>
                <div class="menu-item" onclick="showDataAnggota()">
                    <i class="fas fa-users"></i>
                    <p>Data Anggota Kas</p>
                </div>
                <div class="menu-item" id="menu-laporan-kas" onclick="showCashReport()"> 
                    <i class="fas fa-chart-line"></i>
                    <p>Laporan Kas</p>
                </div>
                </div>
            
            <div class="motivasi-box">
                <div class="marquee-content">
                    <p style="font-size: 1.1em; font-weight: bold; margin-bottom: 10px; color: #ff5722;">LANCAR BAYAR, LANCAR JALAN!</p> <p>‚ú® **Sinergi Warga:** Pembayaran iuran kas yang lancar dan tepat waktu adalah kunci utama untuk mewujudkan lingkungan yang nyaman, aman, dan bersih. Kontribusi Anda sangat berarti!</p>
                    <p>üè° **Masa Depan Gang:** Mari jaga kebersamaan! Dengan membayar kas RT dan iuran lainnya secara disiplin, kita membangun fondasi kuat untuk program perbaikan fasilitas dan kegiatan sosial di Gang E21-25. Terima kasih atas partisipasinya!</p>
                </div>
            </div>
            </div>

        <div id="result-container">
            <div id="status-message" class="status-message"></div>

            <div id="content-display">
                <h3 style="color:#17a2b8; margin-top: 0;"><i class="fas fa-receipt"></i> Detail Iuran Kas: <span id="user-name"></span></h3>
                
                <div id="data-display"></div>

                <div id="payment-summary">
                    <div class="total-info">
                        <h4 style="margin-bottom: 5px;">Ringkasan Total Harus Dibayar</h4>
                        <div id="tunggakan-detail">
                            </div>
                      
                        <p style="font-size: 1.2em; margin-top: 15px; font-weight: bold;">TOTAL BAYAR: <span id="total-tunggakan" style="font-size: 1.8em; color:#ff5722; display: block;">Rp 0</span></p>
                    </div>
                  
                </div>
                
                <div id="lunas-message" style="
                    display:none; 
                    background-color: #e6ffed; 
                    color: #1e7e34; 
                    padding: 20px; 
                    border-radius: 10px; 
                    text-align: center; 
                    font-size: 1.2em; 
                    margin-top: 20px;
                    border: 2px solid #28a745;
                ">
                    <i class="fas fa-handshake"></i> Terima kasih, Anda sudah membayar kas dengan lancar!
                </div>
              
                 <div id="tunggakan-options" style="margin-top: 20px;">
                    <p style="margin-top:15px; font-style:italic; font-size: 0.9em; text-align: center;"></p> 

                    <button id="btn-show-manual-from-detail" onclick="showManualPayment(currentUserId)">
                        <i class="fas fa-calendar-check"></i> LANJUTKAN KE PEMBAYARAN
                    </button>
                </div>
            </div>
        </div>

        <div id="anggota-data-container" style="display:none; text-align:left;">
             <div id="anggota-table-display"></div>
        </div>

        <div id="manual-payment-section" style="display:none; text-align: left;">
            <h3 style="text-align: center;">üíµ Form Pembayaran Kas Gang E21-25</h3>
            <p style="text-align: center; margin-bottom: 20px;">Pembayaran untuk iuran spesifik beberapa bulan sekaligus.</p>
            
            <div style="background-color: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <p style="font-weight: bold; font-size: 1.1em; margin-bottom: 5px;">Untuk Warga:</p>
                <p style="font-size: 1.5em; color:#ff5722; font-weight: bold; margin-top: 0;" id="manual-user-detail"></p>
                <p style="font-size: 0.9em; color: #6c757d; margin-top: -10px;">(Iuran per bulan: <span id="iuran-bulanan-manual"></span>)</p>
            </div>

            <form id="payment-form-manual">
                
                <div class="form-group" style="text-align: left;" id="group-tunggakan-2025">
                     <label for="tunggakan-2025-amount"><i class="fas fa-exclamation-triangle"></i> Tunggakan Tahun 2025</label>
                     <input type="text" id="tunggakan-2025-amount" readonly style="text-align: right;">
                     <p style="font-style: italic; color: #721c24; font-size: 0.85em; margin-top: 5px;">*Pembayaran akan otomatis melunasi Tunggakan 2025 ini terlebih dahulu.</p>
                </div>

                <div class="form-group" style="text-align: left; margin-top: 20px;">
                    <label for="manual-amount"><i class="fas fa-money-bill-wave"></i> masukan Jumlah Pembayaran (Rp) Total Yang Disetor</label>
                    <input type="number" id="manual-amount" name="amount" min="1" step="1" required placeholder="Contoh: 25000" value="">
                    <p style="margin-top:5px; font-style:italic; font-size: 0.85em;" >*Minimun bayar adalah tunggakan 2025 + 1 bulan iuran 2026, atau 1 bulan iuran jika 2025 lunas.</p>
                </div>

                <div class="form-group" style="text-align: left;">
                    <label for="manual-month"><i class="fas fa-list-alt"></i> Detail Pelunasan</label>
                    <input type="text" id="manual-month" name="month" required readonly placeholder="Diisi otomatis..." style="background-color: #eee; font-size: 1em !important; font-weight: normal;">
                    <p style="margin-top:5px; font-style:italic; font-size: 0.85em;" >*Detail pelunasan iuran 2026 yang tercapai (termasuk sisa/lebih bayar).</p>
                </div>

                <div class="form-group" style="text-align: left;">
                    <label><i class="fas fa-exchange-alt"></i> Pilih Metode Pembayaran</label>
                    
                    <div class="radio-group">
                        <input type="radio" id="manual-qrcode" name="method" value="QR Code (QRIS)" checked>
                        <label for="manual-qrcode"><i class="fas fa-qrcode"></i> QRIS</label>

                        <input type="radio" id="manual-banktransfer" name="method" value="Transfer Bank">
                        <label for="manual-banktransfer"><i class="fas fa-university"></i> Transfer Bank</label>
                        
                        <input type="radio" id="manual-offline" name="method" value="Offline (Tunai)">
                        <label for="manual-offline"><i class="fas fa-hand-holding-usd"></i> Tunai</label>
                    </div>
                </div>

                <button type="submit"><i class="fas fa-file-invoice"></i> BUAT INSTRUKSI PEMBAYARAN
                </button>
            </form>

        </div>
        
        <div id="instruction-container" style="display:none;">
             <div id="payment-instruction-content"></div>

                <hr style="margin: 20px 0;">

                <div id="confirmation-container">
                    <input type="checkbox" id="proof-confirmation" required>
                    <label for="proof-confirmation" style="font-weight: bold; color: #dc3545;"><i class="fas fa-check-double"></i> Saya mengkonfirmasi sudah <span id="confirm-action">transfer</span> dan siap mengirimkan bukti via WhatsApp.</label>
                </div>
                
                <button id="btn-whatsapp-proof" disabled>
                    <i class="fab fa-whatsapp"></i> KIRIM KONFIRMASI VIA WHATSAPP
                </button>
        </div>
        
        <div id="cash-report-container">
            <h3 style="color:#17a2b8; margin-top: 10px;"><i class="fas fa-chart-line"></i> Laporan Kas Bulanan 
                <span id="cash-report-admin-tools">
                    </span>
            </h3>
            <div id="report-content"></div>
        </div>
        <button id="btn-back-to-detail" class="btn-back" onclick="showDataUser(currentUserId)" style="display:none;">
            <i class="fas fa-chevron-left"></i> Kembali
        </button>
        <button id="btn-back-to-manual-form" class="btn-back" onclick="showManualPayment(currentUserId)" style="display:none;">
            <i class="fas fa-chevron-left"></i> Kembali ke Form Pembayaran
        </button>
        <button id="btn-back-to-dashboard" class="btn-back" onclick="showDashboard()" style="display:none;">
            <i class="fas fa-chevron-left"></i> Kembali ke Dashboard
        </button>

    </div>
</div>

<div id="bottom-nav" style="display:none;">
    <div class="nav-item" id="nav-dashboard" onclick="showDashboard()">
        <i class="fas fa-home"></i>
        <span>Home</span>
    </div>
    <div class="nav-item" id="nav-anggota" onclick="showDataAnggota()">
        <i class="fas fa-users"></i>
        <span>Anggota</span>
    </div>
    <div class="nav-item" id="nav-report" onclick="showCashReport()">
        <i class="fas fa-chart-bar"></i>
        <span>Laporan</span>
    </div>
    <div class="nav-item profile-item" id="nav-profile" onclick="showDataUser(currentUserId)">
        <i class="fas fa-user-circle" style="font-size: 1.6em;"></i>
        <p id="profile-name-short">[Nama]</p>
        <span id="profile-id-short">[Blok]</span>
    </div>
</div>


  
<script>
    // =======================================
    // === KONFIGURASI USER PETUGAS (REVISI) ===
    // =======================================
    const PETUGAS_USERS = [
        // dataId: Blok Warga yang diawasi/menjadi data utama
        { username: 'admin', password: '123', name: 'Admin Utama', dataId: 'E25-25', isAdmin: true }, 
        
        // --- DAFTAR PETUGAS BARU ---
        { username: 'novry', password: '2138', name: 'Novry', dataId: 'E21-38', isAdmin: false },
        { username: 'fathur', password: '2139', name: 'Fathur', dataId: 'E21-39', isAdmin: false },
        { username: 'hanif', password: '2141', name: 'Hanif', dataId: 'E21-41', isAdmin: false },
        { username: 'eka adi', password: '2142', name: 'Eka Adi', dataId: 'E21-42', isAdmin: false },
        { username: 'larasati', password: '2143', name: 'Laras', dataId: 'E21-43', isAdmin: false },
        { username: 'rahman', password: '2146', name: 'Rahman', dataId: 'E21-46', isAdmin: false },
        { username: 'rakel', password: '2147', name: 'Rakel', dataId: 'E21-47', isAdmin: false },
        { username: 'hendra', password: '2148', name: 'Hendra', dataId: 'E21-48', isAdmin: false }, 
        { username: 'nana', password: '2149', name: 'Nana rusmana', dataId: 'E21-49', isAdmin: false },
        { username: 'aji', password: '2157', name: 'Aji', dataId: 'E21-57', isAdmin: false },
        { username: 'rohman', password: '2151', name: 'Rohman', dataId: 'E21-51', isAdmin: false },
        { username: 'viko', password: '2153', name: 'Viko', dataId: 'E21-53', isAdmin: false },
        { username: 'hendri', password: '2155', name: 'Hendri', dataId: 'E21-55', isAdmin: false },
        { username: 'riyandi', password: '2156', name: 'Riyandi', dataId: 'E21-56', isAdmin: false },
        { username: 'angga', password: '2160', name: 'Angga', dataId: 'E21-60', isAdmin: false },
        { username: 'iwan', password: '2161', name: 'Iwan', dataId: 'E21-61', isAdmin: false },
        { username: 'mario', password: '2165', name: 'Mario', dataId: 'E21-65', isAdmin: false },
        { username: 'koko', password: '2166', name: 'Koko', dataId: 'E21-66', isAdmin: false },
        { username: 'rico', password: '2167', name: 'Rico', dataId: 'E21-67', isAdmin: false },
        { username: 'irwan', password: '2168', name: 'Irwan', dataId: 'E21-68', isAdmin: false },
        { username: 'toro', password: '2169', name: 'Toro', dataId: 'E21-69', isAdmin: false },
        { username: 'topan', password: '2170', name: 'Topan', dataId: 'E21-70', isAdmin: false },
        { username: 'heri', password: '2171', name: 'Heri', dataId: 'E21-71', isAdmin: false },
        { username: 'bayu ade', password: '2172', name: 'Bayu Ade', dataId: 'E21-72', isAdmin: false },
        { username: 'firly', password: '2173', name: 'Firly', dataId: 'E21-73', isAdmin: false },

        { username: 'krisna', password: '2503', name: 'KRISNA', dataId: 'E25-03', isAdmin: false },
        { username: 'deny', password: '2508', name: 'DENY', dataId: 'E25-08', isAdmin: false },
        { username: 'chandra', password: '2509', name: 'CHANDRA', dataId: 'E25-09', isAdmin: false },
        { username: 'alfian', password: '2510', name: 'ALFIAN', dataId: 'E25-10', isAdmin: false },
        { username: 'tedi', password: '2511', name: 'TEDI', dataId: 'E25-11', isAdmin: false },
        { username: 'deri', password: '2515', name: 'DERI', dataId: 'E25-15', isAdmin: false },
        { username: 'paulus', password: '2518', name: 'PAULUS', dataId: 'E25-18', isAdmin: false },
        { username: 'dede dwi', password: '2519', name: 'DEDE DWI', dataId: 'E25-19', isAdmin: false },
        { username: 'anang', password: '2520', name: 'ANANG', dataId: 'E25-20', isAdmin: false },
        { username: 'parulian', password: '2521', name: 'PARULIAN', dataId: 'E25-21', isAdmin: false },
        { username: 'bayu nur', password: '2522', name: 'BAYU NUR', dataId: 'E25-22', isAdmin: false },
        { username: 'waluyo', password: '2523', name: 'WALUYO', dataId: 'E25-23', isAdmin: false },
        { username: 'hadi', password: '2527', name: 'HADI', dataId: 'E25-27', isAdmin: false },
        { username: 'pakdeh agung', password: '2528', name: 'Pakdeh Agung', dataId: 'E25-28', isAdmin: false },
        { username: 'budi almawan', password: '2530', name: 'BUDI ALMAWAN', dataId: 'E25-30', isAdmin: false },
        { username: 'bagus', password: '2531', name: 'BAGUS', dataId: 'E25-31', isAdmin: false },
        { username: 'asep', password: '2532', name: 'ASEP', dataId: 'E25-32', isAdmin: false },
        { username: 'dede gunawan', password: '2533', name: 'DEDE GUNAWAN', dataId: 'E25-33', isAdmin: false },
        { username: 'kardan', password: '2535', name: 'KARDAN', dataId: 'E25-35', isAdmin: false },
        { username: 'rendy', password: '2536', name: 'RENDY', dataId: 'E25-36', isAdmin: false },
        { username: 'vera', password: '2537', name: 'VERA', dataId: 'E25-37', isAdmin: false }
    ];

    const KAS_SALDO_DUMMY = 3500000;

    // =======================================
    // === FUNGSI LOGIN & LOGOUT (MODIFIKASI) ===
    // =======================================
    const loadingPage = document.getElementById('loading-page'); /* === MODIFIKASI BARU === */
    const loginContainer = document.getElementById('login-container');
    const loginForm = document.getElementById('login-form');
    const appContainer = document.getElementById('container-iuran');
    const loginMessage = document.getElementById('login-message');
    const currentUserInfo = document.getElementById('current-user-info');
    const bottomNav = document.getElementById('bottom-nav'); // BARU

    const adminDashboard = document.getElementById('admin-dashboard');
    const resultContainer = document.getElementById('result-container'); 
    const manualPaymentSection = document.getElementById('manual-payment-section');
    const instructionContainer = document.getElementById('instruction-container');
    const anggotaDataContainer = document.getElementById('anggota-data-container');
    const cashReportContainer = document.getElementById('cash-report-container'); 
    const reportContentDiv = document.getElementById('report-content'); 
    const menuLaporanKas = document.getElementById('menu-laporan-kas'); 
    const iuranBulananManual = document.getElementById('iuran-bulanan-manual');
    const menuGridDashboard = document.getElementById('menu-grid-dashboard'); // BARU
    const toggleMenuBtn = document.getElementById('toggle-menu-btn'); // BARU
    
    const btnBackToDetail = document.getElementById('btn-back-to-detail');
    const btnBackToManualForm = document.getElementById('btn-back-to-manual-form');
    const btnBackToDashboard = document.getElementById('btn-back-to-dashboard');
    
    // VARIABEL NOTIFIKASI BARU
    const notificationPopup = document.getElementById('notification-popup');
    const notificationMessageSpan = document.getElementById('notification-message');
    
    let currentUserId = '';
    let currentUserName = ''; 
    let isAdmin = false;

    function checkLoginStatus() {
         /* === MODIFIKASI BARU: Tambah delay untuk splash screen === */
        setTimeout(() => {
            loadingPage.style.opacity = '0';
            setTimeout(() => {
                loadingPage.style.display = 'none';
                
                const loggedInUser = localStorage.getItem('loggedInUser');
                if (loggedInUser) {
                    const user = JSON.parse(loggedInUser);
                    currentUserId = user.dataId;
                    currentUserName = user.name;
                    isAdmin = user.isAdmin;
                    showApp(user);
                } else {
                    showLogin();
                }
            }, 500); // Tunggu transisi opacity
        }, 1500); // Tampilkan splash screen selama 1.5 detik
    }

    function showApp(user) {
        loginContainer.style.display = 'none';
        appContainer.style.display = 'block';
        bottomNav.style.display = 'flex'; // Tampilkan bottom nav
        
        currentUserInfo.innerHTML = `<i class="fas fa-user-shield"></i> Selamat Datang, **${user.name}**${user.isAdmin ? ' (Admin)' : ''}`;
        
        // Update Bottom Nav Profile
        document.getElementById('profile-name-short').textContent = user.name.split(' ')[0];
        document.getElementById('profile-id-short').textContent = user.dataId;

        showDashboard();
        
        // === TAMBAHAN BARU: Cek notifikasi saat login ===
        checkAndShowNotification(user.dataId);
    }
    
    function setActiveNav(pageId) {
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        if (pageId === 'dashboard') {
            document.getElementById('nav-dashboard').classList.add('active');
            document.getElementById('nav-profile').classList.remove('active');
        } else if (pageId === 'anggota') {
            document.getElementById('nav-anggota').classList.add('active');
        } else if (pageId === 'report') {
            document.getElementById('nav-report').classList.add('active');
        } else if (pageId === 'detail' || pageId === 'payment-form' || pageId === 'instruction') {
            // Ketika di detail/form, aktifkan nav profile
            document.getElementById('nav-profile').classList.add('active');
        }
    }

    function showPage(pageId) {
        adminDashboard.style.display = 'none';
        resultContainer.style.display = 'none';
        manualPaymentSection.style.display = 'none';
        instructionContainer.style.display = 'none';
        anggotaDataContainer.style.display = 'none';
        cashReportContainer.style.display = 'none'; 
        
        btnBackToDetail.style.display = 'none';
        btnBackToManualForm.style.display = 'none';
        btnBackToDashboard.style.display = 'none';

        if (pageId === 'dashboard') {
            adminDashboard.style.display = 'block';
        } else if (pageId === 'detail') {
            resultContainer.style.display = 'block';
            btnBackToDashboard.style.display = 'block';
        } else if (pageId === 'payment-form') {
            manualPaymentSection.style.display = 'block';
            btnBackToDashboard.style.display = 'block';
        } else if (pageId === 'instruction') {
            instructionContainer.style.display = 'block';
            btnBackToManualForm.style.display = 'block';
        } else if (pageId === 'anggota') {
            anggotaDataContainer.style.display = 'block';
            btnBackToDashboard.style.display = 'block'; 
        } else if (pageId === 'report') { 
            cashReportContainer.style.display = 'block';
            btnBackToDashboard.style.display = 'block';
        }

        setActiveNav(pageId);
    }
    
    function showDashboard() {
        showPage('dashboard');
        
        const saldoValueSpan = document.getElementById('current-saldo-value');
        saldoValueSpan.textContent = `Rp ${KAS_SALDO_DUMMY.toLocaleString('id-ID')}`;
        
        // MODIFIKASI: Mengganti teks di bawah saldo
        document.getElementById('current-saldo-text').textContent = `GANG E21-25. DARI KITA UNTUK KITA.`;

        document.querySelector('#admin-dashboard .menu-grid .menu-item:first-child').innerHTML = `
            <i class="fas fa-id-card-alt"></i>
            <p>Data Kas Saya</p>
            <p style="font-size:0.7em; margin-top: 3px;">(Blok: ${currentUserId})</p>
        `;
        
        document.getElementById('show-signup').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('signup-box').style.display = 'block';
        });

        document.getElementById('hide-signup').addEventListener('click', function() {
            document.getElementById('signup-box').style.display = 'none';
            document.getElementById('login-box').style.display = 'block';
        });
        
        // === TAMBAHAN BARU: Cek notifikasi saat kembali ke Dashboard ===
        checkAndShowNotification(currentUserId);
    }

    // FUNGSI TOGGLE MENU GRID (BARU)
    function toggleMenuGrid() {
        const isHidden = menuGridDashboard.classList.toggle('hidden');
        if (isHidden) {
            toggleMenuBtn.innerHTML = '<i class="fas fa-chevron-down"></i>';
            toggleMenuBtn.querySelector('i').classList.remove('rotated');
        } else {
            toggleMenuBtn.innerHTML = '<i class="fas fa-chevron-up"></i>';
            toggleMenuBtn.querySelector('i').classList.add('rotated');
        }
    }
    
    function showLogin() {
        loginContainer.style.display = 'flex';
        appContainer.style.display = 'none';
        bottomNav.style.display = 'none'; // Sembunyikan bottom nav
        loginMessage.style.display = 'none';
        loginForm.reset();
        
    }

    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        const user = PETUGAS_USERS.find(u => u.username.toLowerCase() === username.toLowerCase() && u.password === password);

        if (user) {
            localStorage.setItem('loggedInUser', JSON.stringify(user));
            currentUserId = user.dataId;
            currentUserName = user.name;
            isAdmin = user.isAdmin;
            showApp(user);
        } else {
            loginMessage.style.display = 'block';
        }
    });

    function logout() {
        localStorage.removeItem('loggedInUser');
        alert('Anda telah logout.');
        showLogin();
    }
    
    function showDataUser(id) {
        const foundUser = DUMMY_DATA.find(user => user.id === id);
        
        showPage('detail');
        document.getElementById('content-display').style.display = 'block'; 

        if (foundUser) {
            displayUserData(foundUser); 
        } else {
            statusMessageDiv.className = 'status-message status-not-found';
            statusMessageDiv.innerHTML = `‚ùå Data Iuran untuk **${id}** Tidak Ditemukan. Hubungi Bendahara.`;
            document.getElementById('content-display').style.display = 'none';
        }
    }
    
    function showManualPayment(id) {
        showPage('payment-form');
        
        const userData = DUMMY_DATA.find(user => user.id === id);
        if (!userData) return;
        
        const iuranBulanan = userData.iuran_bulanan || IURAN_NORMAL;
        iuranBulananManual.textContent = `Rp ${iuranBulanan.toLocaleString('id-ID')}`;

        const tunggakan2025 = userData.tunggakan_2025 || 0;
        
        // MODIFIKASI: Mengatur nilai input manual-amount menjadi kosong
        manualAmountInput.value = ''; 
        manualAmountInput.dispatchEvent(new Event('input')); 
        
        manualAmountInput.min = (tunggakan2025 > 0) ? tunggakan2025 : iuranBulanan;

        if(proofConfirmationCheckbox) proofConfirmationCheckbox.checked = false; 
        btnWhatsappProof.disabled = true;
        btnWhatsappProof.classList.remove('active');
        confirmActionSpan.textContent = 'transfer'; 
    }
    
    function showDataAnggota() {
        showPage('anggota');
        
        /* === MODIFIKASI BARU: Ubah Header Tabel dan Hapus Tombol Detail Bayar === */
        let html = `
            <h3 style="color:#17a2b8; margin-top: 10px;"><i class="fas fa-users"></i> Data Anggota Kas Gang E21-25
            ${isAdmin ? `<button class="edit-button" onclick="addAnggotaData()" style="background-color: #28a745; margin-left: 10px;"><i class="fas fa-plus-circle"></i> Tambah Anggota</button>` : ''}
            </h3>
            <div id="anggota-table-display">
                <table class="data-anggota-table">
                    <thead>
                        <tr>
                            <th>BLOK</th>
                            <th>NAMA Warga</th>
                            <th>Tunggakan 2025 (Rp)</th>
                            <th>Sisa Pembayaran 2026</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        
        DUMMY_DATA.forEach(user => {
            const tunggakan2025IDR = user.tunggakan_2025.toLocaleString('id-ID');
            const tunggakan2026Count = user.iuran.filter(i => i.status === 'BLUM BAYAR').length;
            let status2026 = (tunggakan2026Count === 0) ? '<span class="lunas">Lunas</span>' : 
                             `<span class="belum">${tunggakan2026Count} bulan</span>`;

            // === MODIFIKASI: Menghilangkan tombol Detail Bayar ===
            let aksiButtons = ''; 
            
            // Tambahkan tombol edit/hapus HANYA jika Admin
            if (isAdmin) {
                aksiButtons += `
                   <button class="edit-button" onclick="editAnggotaData('${user.id}')"><i class="fas fa-edit"></i> Edit</button>
                   <button class="edit-button" onclick="deleteAnggotaData('${user.id}')" style="background-color: #dc3545;"><i class="fas fa-trash"></i> Hapus</button>
                `;
            }

            html += `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.nama}</td>
                    <td class="tunggakan-2025-value">${tunggakan2025IDR}</td>
                    <td>${status2026}</td>
                    <td>${aksiButtons}</td>
                </tr>
            `;
        });

        html += `
                    </tbody>
                </table>
            </div>
        `;
        
        document.getElementById('anggota-data-container').innerHTML = html;
    }
    
    function editAnggotaData(userId) {
        if (!isAdmin) {
            alert('Anda tidak memiliki izin untuk mengubah data anggota.');
            return;
        }
        const userIndex = DUMMY_DATA.findIndex(user => user.id === userId);
        if (userIndex === -1) return;

        const user = DUMMY_DATA[userIndex];
        
        let currentMonths = user.iuran.map(i => i.bulan + ": " + i.status).join(', ');
        
        const newTunggakan2025 = prompt(`Edit Tunggakan 2025 (saat ini: Rp ${user.tunggakan_2025.toLocaleString('id-ID')}):`, user.tunggakan_2025);
        
        if (newTunggakan2025 !== null && !isNaN(parseInt(newTunggakan2025))) {
            user.tunggakan_2025 = parseInt(newTunggakan2025);
        }
        
        const newMonthsStatus = prompt(`Edit Status Iuran 2026 (Format: Bulan:LUNAS/BLUM BAYAR, ...)\n\nContoh: JANUARI:LUNAS, FEBRUARI:BLUM BAYAR\n\nStatus saat ini:\n${currentMonths}`, currentMonths);
        
        let paymentMade = false; // Flag untuk notifikasi

        if (newMonthsStatus !== null) {
             const monthUpdates = newMonthsStatus.split(',').map(s => s.trim()).filter(s => s.includes(':'));
             monthUpdates.forEach(update => {
                 const [month, status] = update.split(':').map(s => s.trim().toUpperCase());
                 const iuranItem = user.iuran.find(item => item.bulan === month);
                 
                 // === MODIFIKASI TAMBAHAN NOTIFIKASI ===
                 if (iuranItem && iuranItem.status === 'BLUM BAYAR' && status === 'LUNAS') {
                     iuranItem.status = status;
                     logPaymentNotification(user.nama, month); 
                     paymentMade = true;
                 } else if (iuranItem && (status === 'LUNAS' || status === 'BLUM BAYAR')) {
                     iuranItem.status = status;
                 }
                 // =======================================
             });
        }
        
        DUMMY_DATA[userIndex] = user;
        alert(`Data untuk ${user.nama} (${userId}) berhasil diperbarui.${paymentMade ? ' (Notifikasi Pembayaran telah dikirim ke warga)' : ''}`);
        showDataAnggota();
    }
    
    function addAnggotaData() {
        if (!isAdmin) {
            alert('Anda tidak memiliki izin untuk menambah data anggota.');
            return;
        }
        
        const newId = prompt('Masukkan BLOK Warga Baru (Contoh: E25-10):');
        if (!newId) return;
        
        if (DUMMY_DATA.find(user => user.id === newId.toUpperCase())) {
            alert(`ID Blok ${newId} sudah ada.`);
            return;
        }
        
        const newName = prompt(`Masukkan NAMA Warga untuk BLOK ${newId}:`);
        if (!newName) return;
        
        const iuranNominal = confirm("Apakah warga ini mendapat subsidi Rp 10.000 (Iuran Rp 15.000)?") ? IURAN_SUBSIDI : IURAN_NORMAL;
        const defaultIuran = createIuranData(0, iuranNominal);

        const newUser = {
            id: newId.toUpperCase(),
            nama: newName.toUpperCase(),
            tunggakan_2025: 0, 
            iuran: defaultIuran,
            iuran_bulanan: iuranNominal,
            subsidi: (iuranNominal === IURAN_SUBSIDI)
        };
        
        DUMMY_DATA.push(newUser);
        alert(`Anggota ${newName} (${newId}) berhasil ditambahkan.`);
        showDataAnggota(); 
    }
    
    function deleteAnggotaData(userId) {
        if (!isAdmin) {
            alert('Anda tidak memiliki izin untuk menghapus data anggota.');
            return;
        }
        
        if (confirm(`Apakah Anda yakin ingin menghapus data anggota dengan BLOK ${userId}? Tindakan ini tidak dapat dibatalkan.`)) {
            const initialLength = DUMMY_DATA.length;
            DUMMY_DATA = DUMMY_DATA.filter(user => user.id !== userId);
            
            if (DUMMY_DATA.length < initialLength) {
                alert(`Data anggota ${userId} berhasil dihapus.`);
                showDataAnggota();
            } else {
                alert(`Data anggota ${userId} tidak ditemukan.`);
            }
        }
    }


    function showCashReport() {
        showPage('report');
        
        const adminToolsSpan = document.getElementById('cash-report-admin-tools');
        if (isAdmin) {
             adminToolsSpan.innerHTML = `<button class="edit-button" onclick="editCashReport()"><i class="fas fa-edit"></i> Ubah Data</button>`;
        } else {
             adminToolsSpan.innerHTML = '';
        }
        
        displayCashReport();
    }
    
    function displayCashReport() {
        const data = DUMMY_CASH_REPORT;
        let totalPemasukan = data.pemasukan.reduce((sum, item) => sum + item.nominal, 0);
        let totalPengeluaran = data.pengeluaran.reduce((sum, item) => sum + item.nominal, 0);
        
        const formatIDR = (num) => 'Rp ' + num.toLocaleString('id-ID');

        let html = `
            <div class="report-summary-box">
                <div class="summary-card card-pemasukan">
                    <h4><i class="fas fa-arrow-alt-circle-up"></i> Total Pemasukan</h4>
                    <p>${formatIDR(totalPemasukan)}</p>
                </div>
                <div class="summary-card card-pengeluaran">
                    <h4><i class="fas fa-arrow-alt-circle-down"></i> Total Pengeluaran</h4>
                    <p>${formatIDR(totalPengeluaran)}</p>
                </div>
            </div>
            
            <h4 style="color:#ff5722; margin-top: 30px;"><i class="fas fa-minus-square"></i> Rincian Pengeluaran Bulan Ini</h4>
            <table class="cash-table">
                <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Deskripsi</th>
                        <th>Nominal</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        data.pengeluaran.forEach((item, index) => {
            html += `
                <tr id="pengeluaran-${index}">
                    <td>${item.tanggal}</td>
                    <td>${item.deskripsi}</td>
                    <td style="color:#dc3545; font-weight:bold;">${formatIDR(item.nominal)}</td>
                </tr>
            `;
        });
        
        html += `
                </tbody>
            </table>
        `;

        reportContentDiv.innerHTML = html;
    }

    function editCashReport() {
        if (!isAdmin) {
            alert('Anda tidak memiliki izin untuk mengubah laporan kas.');
            return;
        }
        
        const action = prompt('Pilih aksi:\n1. Tambah Pemasukan\n2. Tambah Pengeluaran\n3. Edit Saldo Awal\n4. (Aksi Lainnya)', '1');
        
        if (action === '3') {
            const newSaldoAwal = prompt(`Edit Saldo Awal (Saat ini: ${DUMMY_CASH_REPORT.saldo_awal.toLocaleString('id-ID')})`, DUMMY_CASH_REPORT.saldo_awal);
            if (newSaldoAwal !== null && !isNaN(parseInt(newSaldoAwal))) {
                DUMMY_CASH_REPORT.saldo_awal = parseInt(newSaldoAwal);
                alert('Saldo Awal berhasil diubah.');
            }
        } else if (action === '1' || action === '2') {
            const type = action === '1' ? 'Pemasukan' : 'Pengeluaran';
            const tanggal = prompt(`Masukkan Tanggal ${type} (YYYY-MM-DD):`);
            if (!tanggal) return;
            const deskripsi = prompt(`Masukkan Deskripsi ${type}:`);
            if (!deskripsi) return;
            const nominal = prompt(`Masukkan Nominal ${type} (Angka):`);
            const nominalInt = parseInt(nominal);
            
            if (tanggal && deskripsi && !isNaN(nominalInt) && nominalInt > 0) {
                const newItem = {
                    tanggal: tanggal,
                    deskripsi: deskripsi,
                    nominal: nominalInt
                };
                
                if (action === '1') {
                    DUMMY_CASH_REPORT.pemasukan.push(newItem);
                } else {
                    DUMMY_CASH_REPORT.pengeluaran.push(newItem);
                }
                alert(`${type} berhasil ditambahkan.`);
            } else {
                alert('Input tidak valid.');
            }
        } else {
            alert('Aksi dibatalkan atau tidak valid.');
        }
        
        displayCashReport();
    }

    document.addEventListener('DOMContentLoaded', checkLoginStatus);


    // =======================================
    // === KODE APLIKASI IURAN (DATA DUMMY BARU) ===
    // (Data dan fungsi inti aplikasi tidak diubah)
    // =======================================

    const IURAN_NORMAL = 25000; 
    const SUBSIDI_AMOUNT = 10000; 
    const IURAN_SUBSIDI = 15000; 

    function createIuranData(paidMonthsCount = 0, nominal = IURAN_NORMAL) {
        const months = ['JANUARI', 'FEBRUARI', 'MARET', 'APRIL', 'MEI', 'JUNI', 'JULI', 'AGUSTUS', 'SEPTEMBER', 'OKTOBER', 'NOVEMBER', 'DESEMBER'];
        
        return months.map((month, index) => {
            let status = (index < paidMonthsCount) ? 'LUNAS' : 'BLUM BAYAR';
            
            if (paidMonthsCount < 0 || paidMonthsCount > 12) {
                 status = 'BLUM BAYAR';
            }
            
            return { 
                bulan: month, 
                nominal: nominal, 
                status: status 
            };
        });
    }

let DUMMY_DATA =
[
// GANG E21 (Iuran Normal: 25000)
{ id: 'E21-38', 
  nama: 'NOVRY',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-39', 
  nama: 'FATHUR',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-41', 
  nama: 'HANIF',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-42', 
  nama: 'EKA ADI',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-43', 
  nama: 'LARASATI',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-46', 
  nama: 'RAHMAN',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-47', 
  nama: 'RAKEL',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-48', 
  nama: 'HENDRA',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-49', 
  nama: 'NANA',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-57', 
  nama: 'AJI',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-51', 
  nama: 'ROHMAN',
  tunggakan_2025: 0,
  iuran: createIuranData
  (1, IURAN_NORMAL) },
{ id: 'E21-53', 
  nama: 'VIKO',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-55', 
  nama: 'HENDRI',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-56', 
  nama: 'RIYANDI',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-60', 
  nama: 'ANGGA',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-61', 
  nama: 'IWAN',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-65', 
  nama: 'MARIO',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-66', 
  nama: 'KOKO',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-67', 
  nama: 'RICO',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-68', 
  nama: 'IRWAN',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-69', 
  nama: 'TORO',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-70', 
  nama: 'TOPAN',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-71', 
  nama: 'HERI',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-72', 
  nama: 'BAYU ADE',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E21-73', 
  nama: 'FIRLY',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },


// GANG E25 (Iuran Normal: 25000)
{ id: 'E25-03', 
  nama: 'KRISNA',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-08', 
  nama: 'DENY',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-09', 
  nama: 'CHANDRA',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-10', 
  nama: 'ALFIAN',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },

// Warga Subsidi (Iuran Subsidi: 10000)
{ id: 'E25-11', 
  nama: 'TEDI',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_SUBSIDI), 
  subsidi: true, 
  iuran_bulanan: IURAN_SUBSIDI },
{ id: 'E25-32', 
  nama: 'ASEP',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_SUBSIDI), 
  subsidi: true, 
  iuran_bulanan: IURAN_SUBSIDI },


// GANG E25 (Iuran Normal: 25000)
{ id: 'E25-15', 
  nama: 'DERI',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-18', 
  nama: 'PAULUS',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-19', 
  nama: 'DEDE DWI',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-20', 
  nama: 'ANANG',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-21', 
  nama: 'PARULIAN',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-22', 
  nama: 'BAYU NUR',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-23', 
  nama: 'WALUYO',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-27', 
  nama: 'HADI',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-28', 
  nama: 'Pakdeh Agung',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-30', 
  nama: 'BUDI ALMAWAN',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-31', 
  nama: 'BAGUS',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-33', 
  nama: 'DEDE GUNAWAN',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-35', 
  nama: 'KARDAN',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-36', 
  nama: 'RENDY',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) },
{ id: 'E25-37', 
  nama: 'VERA',
  tunggakan_2025: 0,
  iuran: createIuranData
  (0, IURAN_NORMAL) }
]


    const DUMMY_CASH_REPORT = {
        saldo_awal: 5000000, 
        pemasukan: [
            { tanggal: '2026-01-05', deskripsi: 'Iuran Kas Januari (10 warga)', nominal: 250000 },
            { tanggal: '2026-01-12', deskripsi: 'Iuran Kas Januari (15 warga)', nominal: 375000 },
            { tanggal: '2026-01-20', deskripsi: 'Iuran Kas Februari (5 warga)', nominal: 125000 },
        ],
        pengeluaran: [
            { tanggal: '2026-01-15', deskripsi: 'Pembelian lampu jalan E25', nominal: 150000 },
            { tanggal: '2026-01-25', deskripsi: 'Biaya kebersihan bulanan', nominal: 100000 },
        ]
    };

    const dataDisplay = document.getElementById('data-display');
    const userNameSpan = document.getElementById('user-name');
    const totalTunggakanSpan = document.getElementById('total-tunggakan');
    const statusMessageDiv = document.getElementById('status-message');
    const lunasMessageDiv = document.getElementById('lunas-message');
    const tunggakanOptionsDiv = document.getElementById('tunggakan-options');
    const manualPaymentForm = document.getElementById('payment-form-manual');
    const manualUserDetailSpan = document.getElementById('manual-user-detail');
    const manualAmountInput = document.getElementById('manual-amount'); 
    const manualMonthInput = document.getElementById('manual-month'); 
    
    const instructionContentDiv = document.getElementById('payment-instruction-content');
    const proofConfirmationCheckbox = document.getElementById('proof-confirmation');
    const btnWhatsappProof = document.getElementById('btn-whatsapp-proof');
    const confirmActionSpan = document.getElementById('confirm-action'); 
    
    const tunggakanDetailDiv = document.getElementById('tunggakan-detail');
    const tunggakan2025Group = document.getElementById('group-tunggakan-2025');
    const tunggakan2025Input = document.getElementById('tunggakan-2025-amount');
    const totalInfoDiv = document.querySelector('.total-info'); 

    let currentTunggakanAmount = 0; 
    let currentTunggakanList = []; 
    
    // ===============================================
    // === FUNGSI MENAMPILKAN DATA (LOGIKA BARU) ===
    // ===============================================
    function displayUserData(user) {
        statusMessageDiv.className = 'status-message status-found';
        statusMessageDiv.innerHTML = `‚úÖ Data Iuran Atas nma: ${user.nama} Ditemukan! (Blok: ${user.id})`;

        userNameSpan.textContent = user.nama + ' (' + user.id + ')';
        manualUserDetailSpan.textContent = user.nama + ' (' + user.id + ')'; 
        
        const userIuranBulanan = user.iuran_bulanan || IURAN_NORMAL;

        currentTunggakanList = []; 
        
        const tunggakan2025 = user.tunggakan_2025 || 0;
        
        const paidMonths = user.iuran.filter(item => item.status === 'LUNAS');
        const unpaidMonths = user.iuran.filter(item => item.status === 'BLUM BAYAR');
        
        const firstUnpaidMonth = unpaidMonths.length > 0 ? unpaidMonths[0] : null;
        
        const otherUnpaidMonths = unpaidMonths.slice(1);
        
        let totalTunggakan2026 = unpaidMonths.reduce((sum, item) => {
            currentTunggakanList.push(item.bulan);
            return sum + item.nominal; 
        }, 0);
        
        let totalTunggakanSummary = tunggakan2025 + totalTunggakan2026;

        let htmlContent = `
            <div id="data-display-table">
                <div class="data-header">
                    <span>Bulan (2026)</span>
                    <span>Nominal</span>
                    <span>Keterangan</span>
                </div>
        `;
        
        paidMonths.forEach(item => {
            const nominalIDR = item.nominal.toLocaleString('id-ID');
            htmlContent += `
                <div class="data-row">
                    <span>${item.bulan}</span>
                    <span>Rp ${nominalIDR}</span>
                    <span class="lunas">LUNAS</span>
                </div>
            `;
        });
        
        if (firstUnpaidMonth) {
            const nominalIDR = firstUnpaidMonth.nominal.toLocaleString('id-ID');
            htmlContent += `
                <div class="data-row">
                    <span>${firstUnpaidMonth.bulan}</span>
                    <span>Rp ${nominalIDR}</span>
                    <span class="belum">BELUM BAYAR</span>
                </div>
            `;
        }
        
        if (otherUnpaidMonths.length > 0) {
            htmlContent += `
                <div id="hidden-unpaid-months" style="display:none;">
            `;
            
            otherUnpaidMonths.forEach(item => {
                const nominalIDR = item.nominal.toLocaleString('id-ID');
                htmlContent += `
                    <div class="data-row">
                        <span>${item.bulan}</span>
                        <span>Rp ${nominalIDR}</span>
                        <span class="belum">BELUM BAYAR</span>
                    </div>
                `;
            });
            
            htmlContent += `</div>`;

            htmlContent += `
                <div style="text-align: center; margin-top: 10px;">
                    <button id="btn-toggle-tunggakan" onclick="toggleUnpaidMonths()" style="
                        padding: 8px 15px;
                        background-color: #ff5722;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        font-weight: bold;
                        font-size: 0.9em;
                        transition: background-color 0.2s;
                    ">
                        <i class="fas fa-eye-slash"></i> Tampilkan ${otherUnpaidMonths.length} Tunggakan Lainnya
                    </button>
                </div>
            `;
        }
        
        htmlContent += `</div>`;
        
        dataDisplay.innerHTML = htmlContent;
        
        totalTunggakanSpan.textContent = 'Rp ' + totalTunggakanSummary.toLocaleString('id-ID');
        currentTunggakanAmount = totalTunggakanSummary;
        
        let detailHtml = `
            <div class="tunggakan-header">
                <div class="col-deskripsi">Keterangan</div>
                <div>Jumlah Bulan / Item</div>
                <div>Nominal</div>
            </div>
        `;
        
        if (tunggakan2025 > 0) {
            detailHtml += `
                <div class="tunggakan-line">
                    <span class="col-deskripsi">Tunggakan Tahun 2025</span>
                    <span>1 Item</span>
                    <span style="color:#dc3545; font-weight:bold;">Rp ${tunggakan2025.toLocaleString('id-ID')}</span>
                </div>
            `;
        } else {
             detailHtml += `
                <div class="tunggakan-line">
                    <span class="col-deskripsi">Tunggakan Tahun 2025</span>
                    <span>Lunas</span>
                    <span style="color:#28a745; font-weight:bold;">Rp 0</span>
                </div>
            `;
        }
        
        detailHtml += `
            <div class="tunggakan-line">
                <span class="col-deskripsi">Iuran Periode 2026</span>
                <span>${currentTunggakanList.length} Bulan</span>
                <span>Rp ${totalTunggakan2026.toLocaleString('id-ID')}</span>
            </div>
            <div class="tunggakan-line" style="border-bottom: none;">
                <span class="col-deskripsi" style="font-style: italic; font-size: 0.9em; color: #6c757d; font-weight: normal;">Bayar per bulan Rp ${userIuranBulanan.toLocaleString('id-ID')}</span>
                <span></span>
                <span></span>
            </div>
            <div class="tunggakan-total">
                <span>GRAND TOTAL HARUS DIBAYAR:</span> 
                <span>Rp ${totalTunggakanSummary.toLocaleString('id-ID')}</span>
            </div>
        `;
        
        tunggakanDetailDiv.innerHTML = detailHtml;
        
        if (tunggakan2025 > 0) {
            tunggakan2025Input.value = `Rp ${tunggakan2025.toLocaleString('id-ID')}`;
            tunggakan2025Group.style.display = 'block';
            manualAmountInput.min = (tunggakan2025 > 0) ? tunggakan2025 : userIuranBulanan; 
        } else {
            tunggakan2025Input.value = 'Rp 0 (LUNAS)';
            tunggakan2025Group.style.display = 'none';
            manualAmountInput.min = userIuranBulanan; 
        }
        
        iuranBulananManual.textContent = `Rp ${userIuranBulanan.toLocaleString('id-ID')}`;
        
        if (totalTunggakanSummary > 0) {
            tunggakanOptionsDiv.style.display = 'block'; 
            lunasMessageDiv.style.display = 'none';
            totalInfoDiv.style.backgroundColor = '#fff'; 
            totalInfoDiv.style.color = '#333';
            
            // Kode pengisian otomatis di form pembayaran sudah dihapus di showManualPayment()
            manualAmountInput.value = '';
            manualAmountInput.dispatchEvent(new Event('input')); 

        } else {
            tunggakanOptionsDiv.style.display = 'none'; 
            lunasMessageDiv.style.display = 'block';
            totalTunggakanSpan.textContent = 'Rp 0 (Semua Iuran Lunas!)';
            totalInfoDiv.style.backgroundColor = '#e6ffed';
            totalInfoDiv.style.color = '#1e7e34';
            tunggakanDetailDiv.innerHTML = ''; 
        }
    }
    
    // ===============================================
    // === FUNGSI BARU UNTUK TOGGLE TUNGGAKAN (BARU) ===
    // ===============================================
    function toggleUnpaidMonths() {
        const hiddenDiv = document.getElementById('hidden-unpaid-months');
        const toggleButton = document.getElementById('btn-toggle-tunggakan');
        
        if (!hiddenDiv || !toggleButton) return;

        if (hiddenDiv.style.display === 'none') {
            hiddenDiv.style.display = 'block';
            toggleButton.innerHTML = '<i class="fas fa-eye"></i> Sembunyikan Tunggakan Lainnya';
            toggleButton.style.backgroundColor = '#6c757d';
        } else {
            hiddenDiv.style.display = 'none';
            const otherUnpaidCount = hiddenDiv.children.length; 
            toggleButton.innerHTML = `<i class="fas fa-eye-slash"></i> Tampilkan ${otherUnpaidCount} Tunggakan Lainnya`;
            toggleButton.style.backgroundColor = '#ff5722';
        }
    }

    
    // --- Event Listener untuk Input Nominal ---
    manualAmountInput.addEventListener('input', function() {
        const amount = parseInt(manualAmountInput.value);
        
        const userData = DUMMY_DATA.find(user => user.id === currentUserId);
        if (!userData) {
            manualMonthInput.value = 'Data pengguna tidak ditemukan.';
            return;
        }
        
        const tunggakan2025 = userData.tunggakan_2025 || 0;
        const userIuranBulanan = userData.iuran_bulanan || IURAN_NORMAL;

        if (isNaN(amount) || amount < 1) {
            manualMonthInput.value = 'Masukkan jumlah pembayaran yang valid.';
            return;
        }
        
        let remainingAmount = amount;
        let detailPembayaran = '';
        let isTunggakan2025Paid = false;
        
        if (tunggakan2025 > 0) {
            if (amount >= tunggakan2025) {
                remainingAmount -= tunggakan2025;
                detailPembayaran += `LUNAS Tunggakan 2025 (Rp ${tunggakan2025.toLocaleString('id-ID')})`;
                isTunggakan2025Paid = true;
            } else {
                detailPembayaran += `BAYAR Sebagian Tunggakan 2025 (Rp ${amount.toLocaleString('id-ID')} dari Rp ${tunggakan2025.toLocaleString('id-ID')})`;
                manualMonthInput.value = detailPembayaran;
                return;
            }
        } else {
            isTunggakan2025Paid = true; 
        }

        if (isTunggakan2025Paid) {
            const monthsPaidFor2026 = Math.floor(remainingAmount / userIuranBulanan);
            const excessAmount = remainingAmount % userIuranBulanan;

            const monthsAvailable = currentTunggakanList.length;
            const monthsToPay = currentTunggakanList.slice(0, Math.min(monthsPaidFor2026, monthsAvailable));
            const paidMonthsCount = monthsToPay.length;
            
            if (paidMonthsCount > 0) {
                detailPembayaran += (detailPembayaran ? ' & ' : '') + 
                                    `LUNAS Iuran 2026: ${paidMonthsCount} bulan (${monthsToPay.join(', ')}).`;
            }

            if (paidMonthsCount === 0 && monthsAvailable > 0 && remainingAmount > 0) {
                // Kasus bayar kurang dari 1 bulan iuran 2026 setelah lunas 2025
                if (remainingAmount < userIuranBulanan && tunggakan2025 === 0) {
                     detailPembayaran += (detailPembayaran ? ' & ' : '') + 
                                        `BAYAR Sebagian Iuran ${currentTunggakanList[0]} (Kekurangan Rp ${(userIuranBulanan - remainingAmount).toLocaleString('id-ID')}).`;
                } else if (remainingAmount > 0) {
                     detailPembayaran += (detailPembayaran ? ' & ' : '') + 
                                        `BELUM LUNAS Iuran 2026: Rp ${remainingAmount.toLocaleString('id-ID')} (Kekurangan Rp ${(userIuranBulanan - remainingAmount).toLocaleString('id-ID')}).`;
                }
            }
             
            if (paidMonthsCount > 0 && monthsPaidFor2026 > monthsAvailable) {
                const sisaUang = remainingAmount - (monthsAvailable * userIuranBulanan);
                detailPembayaran += ` + KELEBIHAN bayar Rp ${sisaUang.toLocaleString('id-ID')} (Sisa Iuran Lunas).`;
            } else if (paidMonthsCount > 0 && paidMonthsCount === monthsPaidFor2026 && excessAmount > 0) {
                detailPembayaran += ` + SISA/LEBIH bayar Rp ${excessAmount.toLocaleString('id-ID')}.`;
            } else if (paidMonthsCount < monthsPaidFor2026 && monthsAvailable === paidMonthsCount) {
                detailPembayaran += ` + SISA/LEBIH bayar Rp ${remainingAmount.toLocaleString('id-ID')}.`;
            } else if (paidMonthsCount < monthsPaidFor2026) {
                const sisaBulan = monthsPaidFor2026 - paidMonthsCount;
                detailPembayaran += ` (Lunas ${paidMonthsCount} bln, SISA ${sisaBulan} bln berikutnya).`;
            }
        }
        
        manualMonthInput.value = detailPembayaran;
    });
    
    // --- FUNGSI LAINNYA ---
    document.querySelectorAll('#manual-payment-section input[name="method"]').forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.value.includes('Offline')) {
                confirmActionSpan.textContent = 'serahkan uang tunai';
            } else {
                confirmActionSpan.textContent = 'transfer';
            }
            
            if(proofConfirmationCheckbox) proofConfirmationCheckbox.checked = false;
            btnWhatsappProof.disabled = true;
            btnWhatsappProof.classList.remove('active');
        });
    });

    proofConfirmationCheckbox.addEventListener('change', function() {
        if (proofConfirmationCheckbox.checked) {
            btnWhatsappProof.disabled = false;
            btnWhatsappProof.classList.add('active');
        } else {
            btnWhatsappProof.disabled = true;
            btnWhatsappProof.classList.remove('active');
        }
    });

    // Event Listener Form Pembayaran Manual -> Instruksi
    manualPaymentForm.addEventListener('submit', function(e) {
        e.preventDefault(); 
        
        const amountInput = parseInt(document.getElementById('manual-amount').value);
        const userData = DUMMY_DATA.find(user => user.id === currentUserId);
        const tunggakan2025 = userData?.tunggakan_2025 || 0;
        const userIuranBulanan = userData.iuran_bulanan || IURAN_NORMAL;
        const minAmount = (tunggakan2025 > 0) ? tunggakan2025 : userIuranBulanan;
        
        if (amountInput < minAmount) {
             alert(`‚ùå Harap masukkan jumlah minimal Rp ${minAmount.toLocaleString('id-ID')}.`);
             return;
        }
        
        showPage('instruction');
        
        if(proofConfirmationCheckbox) proofConfirmationCheckbox.checked = false; 
        btnWhatsappProof.disabled = true;
        btnWhatsappProof.classList.remove('active');

        const amount = amountInput;
        const detailPembayaran = document.getElementById('manual-month').value; 
        const method = document.querySelector('#manual-payment-section input[name="method"]:checked').value;
        
        let monthsToMarkLunas = [];
        const match = detailPembayaran.match(/Iuran 2026: \d+ bulan \((.*?)\)\./);
        if (match && match[1]) {
            monthsToMarkLunas = match[1].split(',').map(m => m.trim());
        }

        btnWhatsappProof.setAttribute('data-target-months-list', monthsToMarkLunas.join('.')); 
        btnWhatsappProof.setAttribute('data-detail-pembayaran', detailPembayaran); 

        const amountIDR = new Intl.NumberFormat('id-ID').format(amount);
        
        let htmlContent = `
            <h3><i class="fas fa-check-circle"></i> Instruksi Pembayaran Dibuat</h3>
            <div style="background-color: #f7f7f7; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <p style="margin-top: 0;"><strong>Warga:</strong> ${userData.nama} (${currentUserId})</p>
                <p><strong>Detail Pelunasan:</strong> <span style="font-weight: bold; color:#17a2b8;">${detailPembayaran}</span></p>
                <p><strong>Metode:</strong> <span style="font-weight: bold; color:#ff5722;">${method}</span></p>
                <p style="margin-bottom: 0;"><strong>Jumlah Bayar:</strong> <span style="font-size: 1.5em; color: #ff5722; font-weight: bold; display: block;">Rp ${amountIDR}</span></p>
            </div>
            <hr style="margin: 10px 0;">
        `;

        if (method === 'QR Code (QRIS)') {
                 htmlContent += `
                    <p style="text-align: center;">Scan QRIS di bawah ini menggunakan aplikasi pembayaran Anda (Dana, GoPay, Mobile Banking, dll.)</p>
                    <div class="qris-display">
                        <img src="qrcode.jpg" alt="QRIS Kas Gang E21/25" class="qrcode-image">
                    </div>
 <a href="qrcode.jpg" download="QRIS_Kas_Gang_E21-25.jpg" style="
                display: block; 
                width: 100%; 
                padding: 10px; 
                margin-top: 10px; 
                background-color: #28a745; 
                color: white; 
                text-decoration: none; 
                border-radius: 5px; 
                font-weight: bold;
            ">
                <i class="fas fa-download"></i> Download Gambar QRIS
            </a>
        } else if (method === 'Transfer Bank') {
            const mandiriRek = '1234567890';
            const danaNo = '08987645321'; 
            
            // MODIFIKASI: Menambahkan tombol Salin
            htmlContent += `
                <div style="text-align: left;">
                    <p style="font-weight: bold; margin-top: 10px; font-size: 1.1em;">Pilih Salah Satu Rekening Transfer:</p>
                    
                    <div style="background-color: #e8f5f7; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <p style="margin-bottom: 5px; font-size: 1em;">
                            <strong>Bank:</strong> MANDIRI <br>
                            <strong>Nomor Rekening:</strong> <span id="rek-mandiri-val" style="font-weight: bold; color: #17a2b8; font-size: 1.2em;">${mandiriRek}</span>
                            <button onclick="copyToClipboard('${mandiriRek}', this)" class="copy-button-small">
                                <i class="fas fa-copy"></i> Salin
                            </button>
                        </p>
                        <p style="margin-top: 0; font-size: 0.9em;"><strong>Atas Nama:</strong> BENDAHARA KAS</p>
                    </div>
                    
                    <div style="background-color: #fff3cd; padding: 15px; border-radius: 8px;">
                        <p style="margin-bottom: 5px; font-size: 1em;">
                            <strong>Bank:</strong> DANA (Transfer Virtual) <br>
                            <strong>Nomor Akun:</strong> <span id="rek-dana-val" style="font-weight: bold; color: #ff5722; font-size: 1.2em;">${danaNo.slice(0, 4)}-${danaNo.slice(4, 8)}-${danaNo.slice(8, 12)}</span>
                            <button onclick="copyToClipboard('${danaNo}', this)" class="copy-button-small" style="background-color: #ff5722;">
                                <i class="fas fa-copy"></i> Salin
                            </button>
                        </p>
                        <p style="margin-top: 0; font-size: 0.9em;"><strong>Atas Nama:</strong> BENDAHARA KAS</p>
                    </div>
                    
                </div>
                <p style="color: red; font-weight: bold; margin-top: 15px; font-size: 0.95em;">**Penting:** Untuk pembayaran dari semua akun bank ke DANA, maka pembayaran **ditambah Rp 1.000** (biaya admin).</p>
                <span class="warning-text">Penting, setelah melakukan pembayaran centang konfirmasi, dan klik kirim via WhatsApp dengan melampirkan bukti pembayaran.</span>
            `; 
        } else if (method === 'Offline (Tunai)') {
             htmlContent += `
                <div class="offline-instructions" style="
                    background-color: #f0f8ff; 
                    padding: 20px; 
                    border-radius: 10px; 
                    border: 1px dashed #17a2b8;
                    text-align: left;
                ">
                    <p style="font-weight: bold; font-size: 1.3em; color: #17a2b8;"><i class="fas fa-hand-holding-usd"></i> Instruksi Pembayaran Tunai</p>
                    <p>Silakan serahkan **uang tunai sebesar Rp ${amountIDR}** langsung kepada:</p>
                    <ul style="list-style-type: disc; padding-left: 20px;">
                        <li><strong>Petugas:</strong> Bpk. Candra (Bendahara)</li>
                        <li><strong>Alamat:</strong> Rumah E25-09</li>
                        <li><strong>Waktu:</strong> Di komfirmasi dulu ke bendahara.</li>
                    </ul>
                    <p style="font-style: italic; color: #333; font-size: 0.9em;">**Penting:** Pastikan Anda menerima kwitansi atau bukti serah terima dari petugas. Konfirmasi WhatsApp wajib dilakukan setelah serah terima uang, dan minta petugas untuk memverifikasi.</p>
                </div>
            `;
        }

        instructionContentDiv.innerHTML = htmlContent;
        
        btnWhatsappProof.setAttribute('data-name', userData.nama);
        btnWhatsappProof.setAttribute('data-id', currentUserId);
        btnWhatsappProof.setAttribute('data-amount', amountIDR);
        btnWhatsappProof.setAttribute('data-month', detailPembayaran); 
        btnWhatsappProof.setAttribute('data-method', method);
        
        btnWhatsappProof.onclick = function() {
            sendProofViaWhatsApp(
                this.getAttribute('data-name'),
                this.getAttribute('data-id'),
                this.getAttribute('data-amount'),
                this.getAttribute('data-month'),
                this.getAttribute('data-method'),
                this.getAttribute('data-target-months-list') 
            );
        };
    });

    function sendProofViaWhatsApp(name, id, amountIDR, detailPembayaran, method, targetMonthsList) {
        
        if (!proofConfirmationCheckbox.checked) {
             alert('‚ùå Anda harus mencentang konfirmasi pembayaran terlebih dahulu.');
             return;
        }

        const monthsToMarkLunas = targetMonthsList.split('.').filter(m => m !== ''); 
        const amount = parseInt(amountIDR.replace(/[^0-9]/g, '')); 

        const userIndex = DUMMY_DATA.findIndex(user => user.id === id);
        if (userIndex !== -1) {
            const userData = DUMMY_DATA[userIndex];
            const userIuranBulanan = userData.iuran_bulanan || IURAN_NORMAL;
            let totalDibayar = amount;
            
            if (userData.tunggakan_2025 > 0) {
                if (totalDibayar >= userData.tunggakan_2025) {
                    totalDibayar -= userData.tunggakan_2025;
                    userData.tunggakan_2025 = 0; 
                } else {
                    userData.tunggakan_2025 -= totalDibayar; 
                    totalDibayar = 0;
                }
            }
            
            if (totalDibayar >= userIuranBulanan && monthsToMarkLunas.length > 0) {
                monthsToMarkLunas.forEach(targetMonth => {
                    const iuranItem = userData.iuran.find(item => item.bulan === targetMonth && item.status === 'BLUM BAYAR');
                    if (iuranItem && iuranItem.nominal === userIuranBulanan) {
                        iuranItem.status = 'LUNAS'; 
                    }
                });
            }
            
            DUMMY_DATA[userIndex] = userData;
            // === TAMBAHAN BARU: Log Notifikasi Pembayaran ===
            if (monthsToMarkLunas.length > 0) {
                 logPaymentNotification(name, monthsToMarkLunas.join(', '));
            }
            // ===============================================
        }

        showDataUser(id); 

        const phoneNumber = '6285781256570';
        
        let paymentActionText = 'bukti transfer';
        if (method === 'Offline (Tunai)') {
             paymentActionText = 'konfirmasi serah terima uang tunai';
        }
        
        const message = `*Konfirmasi Pembayaran Kas gang E21-25*\n\n` +
                        `Nama: *${name}* (BLOK: ${id})\n` +
                        `Detail Pelunasan: *${detailPembayaran}*\n` + 
                        `Jumlah: *Rp ${amountIDR}*\n` +
                        `Metode: *${method}*\n\n` +
                        `*PENTING:* Kirim ${paymentActionText} di chat ini* untuk diverifikasi.\n\n` +
                        `*Status terkini di aplikasi: Sudah LUNAS (Menunggu Verifikasi).*`;
                        
        const whatsappURL = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
        
        window.open(whatsappURL, '_blank');
    }

    // Auto-fill saat form pembayaran difokuskan (DIBIARKAN AGAR BISA MEMBERI MINIMAL BAYAR)
    manualAmountInput.addEventListener('focus', function() {
        const userData = DUMMY_DATA.find(user => user.id === currentUserId);
        if (!userData) return;
        
        const userIuranBulanan = userData.iuran_bulanan || IURAN_NORMAL;

        if (manualAmountInput.value === '' || parseInt(manualAmountInput.value) < userIuranBulanan) {
            
            const tunggakan2025 = userData.tunggakan_2025 || 0;
            const tunggakan2026List = userData.iuran.filter(item => item.status === 'BLUM BAYAR');
            
            // Hapus pengisian otomatis nominal, tapi biarkan minAmount terisi jika kosong
            // if(tunggakan2025 > 0) {
            //     manualAmountInput.value = tunggakan2025 + userIuranBulanan; 
            // } else if (tunggakan2026List.length > 0) {
            //     manualAmountInput.value = userIuranBulanan;
            // } else {
            //     manualAmountInput.value = 0;
            // }
            // manualAmountInput.dispatchEvent(new Event('input'));
        }
    });
    
    // ===============================================
    // === FUNGSI COPY TO CLIPBOARD (BARU) ===
    // ===============================================
    function copyToClipboard(textToCopy, buttonElement) {
        const originalText = buttonElement.textContent;
        const originalColor = buttonElement.style.backgroundColor;
        const originalTextColor = buttonElement.style.color;

        const cleanText = String(textToCopy).replace(/-/g, '').trim(); 

        navigator.clipboard.writeText(cleanText).then(function() {
            
            buttonElement.textContent = "‚úÖ Tersalin!";
            buttonElement.style.backgroundColor = "#28a745"; 
            buttonElement.style.color = "white"; 

            setTimeout(function() {
                buttonElement.textContent = originalText;
                buttonElement.style.backgroundColor = originalColor;
                buttonElement.style.color = originalTextColor;
            }, 1500); 

        }).catch(function(err) {
            console.error('Gagal menyalin: ', err);
            buttonElement.textContent = "‚ùå Gagal!";
            buttonElement.style.backgroundColor = "#dc3545"; 
            buttonElement.style.color = "white";
            
            setTimeout(function() {
                buttonElement.textContent = originalText;
                buttonElement.style.backgroundColor = originalColor;
                buttonElement.style.color = originalTextColor;
            }, 1500); 
        });
    }

    // ===============================================================
    // === KODE MODIFIKASI DAN TAMBAHAN NOTIFIKASI BARU ===
    // ===============================================================

    // 1. Fungsi untuk mencatat notifikasi pembayaran
    function logPaymentNotification(name, months) {
        const timestamp = new Date().toISOString();
        const notification = {
            message: `Warga **${name}** baru saja melunasi iuran ${months}. Terima kasih!`,
            timestamp: timestamp,
            readBy: [] // Array untuk mencatat siapa saja yang sudah melihat
        };

        let notifications = JSON.parse(localStorage.getItem('paymentNotifications') || '[]');
        notifications.unshift(notification); // Tambahkan di awal
        localStorage.setItem('paymentNotifications', JSON.stringify(notifications));
    }

    // 2. Fungsi untuk menandai notifikasi sudah dibaca oleh user tertentu
    function markNotificationAsRead(userId, notificationIndex) {
        let notifications = JSON.parse(localStorage.getItem('paymentNotifications') || '[]');
        if (notifications[notificationIndex] && !notifications[notificationIndex].readBy.includes(userId)) {
            notifications[notificationIndex].readBy.push(userId);
            localStorage.setItem('paymentNotifications', JSON.stringify(notifications));
        }
    }

    // 3. Fungsi untuk menampilkan notifikasi yang belum dibaca
    function checkAndShowNotification(userId) {
        let notifications = JSON.parse(localStorage.getItem('paymentNotifications') || '[]');
        
        // Cari notifikasi terbaru yang belum dibaca oleh user ini
        const latestUnreadIndex = notifications.findIndex(notif => !notif.readBy.includes(userId));

        if (latestUnreadIndex !== -1) {
            const latestNotif = notifications[latestUnreadIndex];
            notificationMessageSpan.innerHTML = latestNotif.message;
            notificationPopup.style.display = 'block';

            // Tandai notifikasi sebagai sudah dibaca setelah ditampilkan
            markNotificationAsRead(userId, latestUnreadIndex);

            // Sembunyikan setelah 5 detik
            setTimeout(() => {
                notificationPopup.style.display = 'none';
            }, 5000);
        }
    }
    // ===============================================================
</script>

</body>
</html>
